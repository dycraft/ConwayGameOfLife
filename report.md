# 技术文档 - 生命游戏

软件41  
李大洋  
2014013434

## 概要
本程序一开始对细胞进行了随机初始化，然后令其自行演变，期间可以进行人工干涉，或者调节其参数。

本程序实现了以下功能：
- 基础功能（能够进行简单的生命演化）
- 边界循环
- 鼠标点击激活细胞
- 暂停，开始按钮
- 重新开始（仅限运行状态）
- 逐帧播放（仅限停滞状态）NEXT按钮
- 调节演化速度
- 调节网格大小

程序结构：
- css | 文件夹为空（本程序无css样式）
- js
  + game.js | 整个游戏的逻辑与渲染
  + ui.js | 游戏与html之间的衔接与封装
  + util.js | 一些通用性的工具函数
- node_modules | 包含了测试所需要的环境
  + ...
- test
  + test.html | 测试的展示页面
  + test.js | 测试代码
- index.html | 程序的入口
- package.json | node包描述
- report.md | 技术文档

发布地址：
- [程序地址](https://dycraft.github.io/projects/ConwayGameOfLife/)
- [测试页面](https://dycraft.github.io/projects/ConwayGameOfLife/test/test.html)
- [项目地址](https://github.com/dycraft/dycraft.github.io/tree/master/projects/ConwayGameOfLife)

## 实现细节
- 将游戏的循环划分为logic和render。render负责canvas的内容的渲染，logic负责计算各个细胞的状态。用两个矩阵分别存储细胞的状态和周围细胞数量。
- 计算周围细胞个数：考虑到边界的循环，在计算边界的细胞的时候，将索引增加或减少一个周期。
- 鼠标点击激活细胞：用DOM原生的事件响应函数，获取点击的坐标，转化为矩阵。
- 暂停：使用原生的clearInteval来关闭，开始时用setInteval重新建立计时器
- 重新开始：将存储矩阵初始化
- NEXT按钮：手动循环一次计时器
- 调节速度：改变计时器的周期
- 调节大小：改变每个细胞的像素大小，并重新调节矩阵。由于考虑到矩阵的变化问题，所以在一开始就申请一个最大的矩阵，按照像素大小进行部分选取。


## 单元测试
由于canvas等dom元素的限制，导致很多与ui相关的函数不能测试，所以仅对与游戏逻辑相关的函数进行了测试。

### 测试环境
- node: @ 6.6.0
- npm: @ 3.10.3
- node package:
  + mocha @ 3.0.2
  + chai @ 3.5.0

### 测试用例的设计
- 对于set型的函数，对其参数进行测试；并检查其产生的副作用是否正确。
- 对于计算周围细胞的函数，设计了4个测试案例。案例1为不涉及到边界的样例，案例2为涉及到边界的案例，案例3为涉及到边界并且有大量交叠，案例4为极限情况。
  + ```
    [[0, 0, 0, 0],      [[1, 2, 2, 1],
     [0, 1, 1, 0],  ->   [2, 3, 3, 2],
     [0, 1, 1, 0],       [2, 3, 3, 2],
     [0, 0, 0, 0]];      [1, 2, 2, 1]];
    ```
  + ```
    [[1, 0, 0, 0],      [[1, 1, 1, 2],
     [0, 0, 0, 0],  ->   [3, 2, 1, 3],
     [1, 0, 0, 1],       [2, 1, 2, 2],
     [0, 0, 0, 1]];      [4, 2, 2, 3]];
    ```
  + ```
    [[1, 1, 1, 1],      [[7, 6, 6, 7],
     [1, 0, 0, 1],  ->   [6, 5, 5, 6],
     [1, 0, 0, 1],       [6, 5, 5, 6],
     [1, 1, 1, 1]];      [7, 6, 6, 7]];
    ```
  + ```
    [[1]];          ->    [[8]];
    ```

- 其余的大多数都是不重要的。

### 运行测试的方法
打开test.html。自动运行...

## 编辑环境
- os: osx 10.12 Sierra
- browser: safari @ 10.0
- node: @ 6.6.0
- npm: @ 3.10.3
- node package:
  + mocha @ 3.0.2
  + chai @ 3.5.0
- linter: linter-jslint @ 3.0 (Atom editor's plugin)

## 参考
- [Wiki - 康威生命游戏](https://zh.wikipedia.org/wiki/康威生命游戏)
